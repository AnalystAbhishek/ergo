package org.accordproject.acceptanceofdelivery

import org.accordproject.contract.*
import org.accordproject.acceptanceofdelivery.*

import jura.moment.* // Date/Time library

contract AcceptanceOfDelivery over TemplateModel {
  clause acceptanceofdelivery(request InspectDeliverable) InspectionResponse throws Error {
    let received = request.deliverableRecievedAt;
    guard (isBefore(received,request.timestamp)) else {
      throw Error{ error : "Timetamp of the transaction is before the deliverable date." }
    }

    let status =
      if isAfter(now, add(received, data.businessDays, "days")) {
        OUTSIDE_INSPECTION_PERIOD
      } else if request.inspectionPassed {
        PASSED_TESTING
      } else {
        FAILED_TESTING
      };
    return new InspectionResponse{
      status : status,
      shipper : this.shipper,   // This should be a relationship
      receiver : this.receiver  // This should be a relationship
    }
  }
}
